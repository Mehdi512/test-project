REPLACE INTO `resources` (`datakey`, `data`, `LastUpdated`, `ResourceGroup`, `startup`, `touched`, `last_modified`) VALUES
('?(Astd)/?(*)/?(OUTManagePasswordPolicies)/group(CompleteGroup)/w(Window)/appearance(StringResource)','<h2>§manage_password_policies§</h2>\r\n%|{messages(OUMessageGroup)/group(CompleteGroup)/w(Window)}|% %|{password_policies(ElementChoiceList)/group(CompleteGroup)/w(Window)}|%\r\n%|{do_new_policy(FlowControl)/group(CompleteGroup)/w(Window)}|%\r\n<br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/group(CompleteGroup)/w(Window)}|%\r\n<br>\r\n','2007-01-19 11:35:30','?(RefillAdmin)','2007-01-19 11:46:24','2007-01-19 11:52:45','2007-01-19 10:52:45'),
('?(Astd)/?(*)/?(OUTManagePasswordPolicy)/group(CompleteGroup)/w(Window)/appearance(StringResource)','%|{messages(OUMessageGroup)/group(CompleteGroup)/w(Window)}|%\r\n<br>\r\n<table width=\"100%\"><tr><td>\r\n<span class=\"input_header\">§policy_name§</span><br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/policy_name(OUTChooseText)/w(Window)}|%\r\n</td><td colspan=\"2\">\r\n<span class=\"input_header\">§policy_description§</span><br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/policy_description(OUTChooseText)/w(Window)}|%\r\n</td></tr>\r\n<tr><td>\r\n<span class=\"input_header\">§password_min_length§</span><br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/password_min_length(OUTChooseText)/w(Window)}|%\r\n</td><td>\r\n<span class=\"input_header\">§password_max_length§</span><br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/password_max_length(OUTChooseText)/w(Window)}|%\r\n</td><td>\r\n<span class=\"input_header\">§password_regexp§</span><br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/password_regexp(OUTChooseText)/w(Window)}|%\r\n</td></tr>\r\n\r\n<tr><td>\r\n<span class=\"input_header\">§change_policy§</span><br>\r\n%|{change_policy(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td><td colspan=\"2\">\r\n<span class=\"input_header\">§change_report§</span><br>\r\n%|{change_report(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td></tr>\r\n<tr><td>\r\n<span class=\"input_header\">§create_policy§</span><br>\r\n%|{create_policy(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td><td>\r\n<span class=\"input_header\">§create_message§</span><br>\r\n%|{create_message(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td><td>\r\n<span class=\"input_header\">§create_template§</span><br>\r\n%|{create_template(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td></tr>\r\n<tr><td>\r\n<span class=\"input_header\">§legal_characters§</span><br>\r\n%|{legal_characters(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td><td>\r\n<span class=\"input_header\">§encryption_format§</span><br>\r\n%|{encryption_format(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td><td>\r\n<span class=\"input_header\">§expiry_period§</span><br>\r\n%|{expiry_period(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td></tr>\r\n\r\n<tr>\r\n<td valign=top>\r\n<span class=\"input_header\">§password_control§</span><br>\r\n%|{password_control(ElementChoiceOption)/group(CompleteGroup)/w(Window)}|%\r\n</td> \r\n<td>\r\n<span class=\"input_header\">§banned_passwords§</span><br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/banned_passwords(OUTChooseText)/w(Window)}|%\r\n</td>\r\n<td>\r\n<span class=\"input_header\">§max_incorrect_attempts§</span><br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/incorrectlogin_max_attempts(OUTChooseText)/w(Window)}|%\r\n</td>\r\n</tr>\r\n\r\n<tr>\r\n<td>\r\n<span class=\"input_header\">§user_passwords_history§</span><br>\r\n%|{manage_password_policy(OUTManagePasswordPolicy)/user_passwords_history(OUTChooseText)/w(Window)}|%\r\n</td>\r\n</tr>\r\n</table>\r\n§visible_password§ %|{visible_password(BooleanChoice)/group(CompleteGroup)/w(Window)}|%\r\n<br>\r\n§password_change_at_first_login§ %|{password_change_at_first_login(BooleanChoice)/group(CompleteGroup)/w(Window)}|%\r\n<br>\r\n\r\n<table><tr><td>\r\n%|{cancel(FlowControl)/group(CompleteGroup)/w(Window)}|%\r\n</td><td>\r\n%|{create_policy(FlowControl)/group(CompleteGroup)/w(Window)}|%\r\n</td><td>\r\n%|{update_policy(FlowControl)/group(CompleteGroup)/w(Window)}|%\r\n</td></tr></table>\r\n','2009-01-08 14:37:53','?(RefillAdmin)','2009-01-08 16:46:36','2009-01-08 16:48:12','2009-01-08 16:48:12'),
('?(Len)/?(*)/?(OUMessageGroup)/pwd_already_exisit_in_history(DODMessage)/group(CompleteGroup)/w(Window)/langmap(StringResource)','msg=User password was used previously, please try another!','2017-02-07 17:47:45','?(RefillAdmin)',NULL,NULL,'2017-02-07 17:47:45'),
('?(Len)/?(*)/?(OUMessageGroup)/pwd_already_exist_in_history(DODMessage)/group(CompleteGroup)/w(Window)/langmap(StringResource)','msg=User password was used previously, please try another!','2009-11-06 12:07:00','?(RefillAdmin)','2009-11-06 12:07:00','2009-11-06 12:07:00','2009-11-06 12:07:00'),
('?(Len)/?(*)/?(OUTManagePasswordPolicy)/group(CompleteGroup)/w(Window)/langmap(StringResource)','policy_name=Policy name\r\npolicy_description=Description\r\npassword_min_length=Password min length\r\npassword_max_length=Max length\r\npassword_regexp=Regexp\r\nchange_policy=Password change policy\r\nchange_report=Change report template\r\nvisible_password=Visible password\r\npassword_change_at_first_login=Password change at first login\r\nencryption_format=Encryption format\r\nlegal_characters=Legal characters\r\ncreate_policy=Password create policy\r\ncreate_message=Create message\r\ncreate_template=Create report template\r\nexpiry_period=Password expiry period\r\nbanned_passwords=Banned passwords\r\npassword_control=Password control\r\nmax_incorrect_attempts=Max Incorrect Logins\r\nuser_passwords_history=Password History limit','2009-01-08 14:38:37','?(RefillAdmin)','2009-01-08 16:46:36','2009-01-08 16:48:12','2009-01-08 16:48:12');

ALTER TABLE `id_password_policies` 
ADD COLUMN `user_passwords_history` tinyint(4) NOT NULL DEFAULT '0' AFTER `incorrectlogin_max_attempt`;


DROP TABLE IF EXISTS `id_users_passwords_history`;

CREATE TABLE `id_users_passwords_history` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `UserKey` int(11) NOT NULL DEFAULT '0',
  `Password` blob NOT NULL,
  `last_modified` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `password_format` int(4) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  KEY `id_users_passwords_history_ibfk_1` (`UserKey`),
  CONSTRAINT `id_users_passwords_history_ibfk_1` FOREIGN KEY (`UserKey`) REFERENCES `id_users` (`UserKey`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;	